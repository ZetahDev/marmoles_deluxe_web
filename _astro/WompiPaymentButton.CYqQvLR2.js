import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.6otl1p8d.js";import{C as I,g as $,p as B,a as U}from"./card.CLwavOJp.js";import{B as x}from"./button.DXSYegzv.js";const A="test",T=void 0,G=void 0,L=void 0,s={publicKey:"pub_test_default",privateKey:T,eventsSecret:G,integritySecret:L,environment:A,redirectUrl:"http://localhost:4321/confirmacion-pago",webhookUrl:void 0};function J({paymentType:h,productName:w,productDescription:N,price:b,quantity:m=1,sku:F,buttonText:v="Pagar con Wompi",className:j=""}){const[C,y]=d.useState(!1),[r,u]=d.useState({name:"",email:"",phone:""}),[g,o]=d.useState(!1),[P,p]=d.useState(!1),E=()=>new Promise((t,i)=>{if(window.WidgetCheckout){p(!0),t();return}if(document.getElementById("wompi-widget-script")){setTimeout(()=>{window.WidgetCheckout?(p(!0),t()):i(new Error("Widget no se cargÃ³ correctamente"))},1e3);return}const a=document.createElement("script");a.id="wompi-widget-script",a.src="https://checkout.wompi.co/widget.js",a.async=!0,a.onload=()=>{console.log("âœ… Wompi Widget cargado correctamente"),p(!0),t()},a.onerror=()=>{console.error("âŒ Error cargando Wompi Widget"),i(new Error("Error cargando el widget de pago"))},document.body.appendChild(a)}),k=async()=>{if(!r.name||!r.email||!r.phone){alert("Por favor completa todos los campos del formulario");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.email)){alert("Por favor ingresa un email vÃ¡lido");return}if(!/^3\d{9}$/.test(r.phone.replace(/\s/g,""))){alert("Por favor ingresa un telÃ©fono vÃ¡lido (10 dÃ­gitos, iniciando con 3)");return}o(!0);try{if(!P)try{await E()}catch(l){console.error("Error cargando Wompi Widget:",l),alert("Error cargando el sistema de pagos. Por favor recarga la pÃ¡gina e intenta nuevamente."),o(!1);return}if(!window.WidgetCheckout){alert("El widget de pago aÃºn no estÃ¡ cargado. Por favor espera un momento e intenta nuevamente."),o(!1);return}const n=$(h),a=B(b*m);if(!s.integritySecret){alert("Error de configuraciÃ³n: No se encontrÃ³ el secreto de integridad. Por favor contacta al administrador."),o(!1);return}const O=`${n}${a}COP${s.integritySecret}`,D=await U(O),R={currency:"COP",amountInCents:a,reference:n,publicKey:s.publicKey,signature:{integrity:D},redirectUrl:s.redirectUrl,customerData:{email:r.email,fullName:r.name,phoneNumber:r.phone,phoneNumberPrefix:"+57"}};new window.WidgetCheckout(R).open(l=>{if(o(!1),l.transaction){const f=l.transaction,c=f.status;c==="APPROVED"?window.location.href=`${s.redirectUrl}?id=${f.id}&reference=${n}&status=APPROVED`:c==="DECLINED"?alert("âŒ Tu pago fue rechazado. Por favor intenta con otro mÃ©todo de pago."):c==="PENDING"?window.location.href=`${s.redirectUrl}?id=${f.id}&reference=${n}&status=PENDING`:c==="ERROR"&&alert("âŒ OcurriÃ³ un error procesando tu pago. Por favor intenta nuevamente.")}else console.log("âš ï¸ Usuario cerrÃ³ el widget sin completar el pago")}),o(!1)}catch(n){console.error("Error generando link de pago:",n),alert("Error al generar el link de pago. Por favor intenta nuevamente."),o(!1)}},S=()=>{switch(h){case"ANTICIPO":return"Anticipo/SeÃ±a";case"SERVICIO":return"Servicio";case"PRODUCTO_CATALOGO":return"Producto del CatÃ¡logo"}},W=t=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(t);return C?e.jsx(I,{className:"p-6 max-w-md mx-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center border-b pb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Datos de Pago"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:S()})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:w}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:N}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Cantidad: ",m]}),e.jsx("span",{className:"text-lg font-bold text-[#8B4513]",children:W(b*m)})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre Completo *"}),e.jsx("input",{type:"text",value:r.name,onChange:t=>u({...r,name:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#8B4513]",placeholder:"Ej: Juan PÃ©rez",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",value:r.email,onChange:t=>u({...r,email:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#8B4513]",placeholder:"ejemplo@email.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"TelÃ©fono *"}),e.jsx("input",{type:"tel",value:r.phone,onChange:t=>{const i=t.target.value.replace(/\D/g,"");u({...r,phone:i})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#8B4513]",placeholder:"3001234567",maxLength:10,required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"10 dÃ­gitos, iniciando con 3"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsx("p",{className:"text-xs text-blue-800",children:"ðŸ”’ Tu pago es procesado de forma segura por Wompi. SerÃ¡s redirigido a su plataforma para completar la transacciÃ³n."})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(x,{variant:"outline",onClick:()=>y(!1),className:"flex-1",disabled:g,children:"Cancelar"}),e.jsx(x,{onClick:k,className:"flex-1 bg-[#8B4513] hover:bg-[#6d3410]",disabled:g,children:g?"Generando...":"Continuar al Pago"})]}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"inline-block bg-yellow-100 text-yellow-800 text-xs px-3 py-1 rounded-full font-medium",children:"âš ï¸ MODO PRUEBA"})})]})}):e.jsx(x,{onClick:()=>y(!0),className:j,size:"lg",children:v})}export{J as default};
