# ğŸ“Š Arquitectura y Flujo del Sistema de Pagos

## ğŸ—ï¸ Arquitectura General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENTE (Navegador)                          â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Sitio Web  â”‚â”€â”€â”€â”€â”€â”€â”‚ Formulario Pago â”‚â”€â”€â”€â”€â”€â”€â”‚ Wompi Checkout â”‚ â”‚
â”‚  â”‚   (Astro)    â”‚      â”‚   (Componente)  â”‚      â”‚   (Externo)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                                 â”‚          â”‚
â”‚         â”‚                                                 â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                                 â”‚
          â”‚                                                 â”‚
          â–¼                                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PÃ¡gina ConfirmaciÃ³nâ”‚                          â”‚  Wompi Payment   â”‚
â”‚   /confirmacion-pagoâ”‚                          â”‚    Platform      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â”‚ Webhook
                                                           â–¼
                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                  â”‚       N8N       â”‚
                                                  â”‚   (Automation)  â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚                                  â”‚                        â”‚
                        â–¼                                  â–¼                        â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Google Sheets   â”‚            â”‚  Email Service   â”‚      â”‚   Telegram     â”‚
              â”‚  (Registro DB)   â”‚            â”‚   (Cliente)      â”‚      â”‚   (Equipo)     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo Detallado del Proceso de Pago

### PASO 1: Cliente Inicia el Pago

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cliente   â”‚
â”‚   Navega    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Visita pÃ¡gina con producto
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PÃ¡gina de Producto/Servicio    â”‚
â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ MÃ¡rmol Blanco Polar        â”‚ â”‚
â”‚  â”‚ $500,000 COP               â”‚ â”‚
â”‚  â”‚                            â”‚ â”‚
â”‚  â”‚ [Pagar con Wompi] â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”€â”€ WompiPaymentButton Component
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PASO 2: Formulario de Datos

```
Cliente hace clic en "Pagar"
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Modal de Datos del Cliente     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                  â”‚
â”‚  Nombre: [___________________]   â”‚
â”‚  Email:  [___________________]   â”‚
â”‚  TelÃ©fono: [_________________]   â”‚
â”‚                                  â”‚
â”‚  [Cancelar]  [Continuar Pago]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. Completa datos
       â–¼
   ValidaciÃ³n
       â”‚
       â”œâ”€ âŒ InvÃ¡lido â†’ Muestra error
       â”‚
       â””â”€ âœ… VÃ¡lido
              â”‚
              â–¼
```

### PASO 3: GeneraciÃ³n de Enlace

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Procesamiento en el Cliente            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  1. Generar referencia Ãºnica:           â”‚
â”‚     ANT-1729875234567-ABC123             â”‚
â”‚                                          â”‚
â”‚  2. Convertir pesos a centavos:          â”‚
â”‚     $500,000 â†’ 50,000,000 centavos       â”‚
â”‚                                          â”‚
â”‚  3. Construir URL de Wompi:              â”‚
â”‚     https://checkout.wompi.co/p/?        â”‚
â”‚     public-key=pub_test_xxx&             â”‚
â”‚     amount-in-cents=50000000&            â”‚
â”‚     reference=ANT-1729875234567-ABC123&  â”‚
â”‚     customer-data:email=...&             â”‚
â”‚     customer-data:full-name=...&         â”‚
â”‚     redirect-url=https://tu-sitio.com/   â”‚
â”‚                   confirmacion-pago      â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. window.location.href = url
       â–¼
```

### PASO 4: Checkout de Wompi

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Wompi Checkout (Externo)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  MÃ¡rmol Blanco Polar - Anticipo 50%     â”‚
â”‚  $500,000 COP                            â”‚
â”‚                                          â”‚
â”‚  Cliente: Juan PÃ©rez                     â”‚
â”‚  Email: juan@example.com                 â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ NÃºmero de Tarjeta                  â”‚ â”‚
â”‚  â”‚ [____-____-____-____]              â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚ CVV      Fecha Venc.               â”‚ â”‚
â”‚  â”‚ [___]    [__/__]                   â”‚ â”‚
â”‚  â”‚                                    â”‚ â”‚
â”‚  â”‚ [ğŸ’³ Pagar $500,000]                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. Cliente completa pago
       â–¼
   Procesamiento
       â”‚
       â”œâ”€ âœ… APROBADO
       â”‚     â”‚
       â”‚     â”œâ”€â”€â”€ Redirect al sitio
       â”‚     â”‚    /confirmacion-pago?id=txn_xxx
       â”‚     â”‚
       â”‚     â””â”€â”€â”€ Webhook a N8N
       â”‚          (async, en paralelo)
       â”‚
       â””â”€ âŒ RECHAZADO
             â””â”€â”€â”€ Redirect al sitio
                  /confirmacion-pago?id=txn_xxx&status=DECLINED
```

### PASO 5: PÃ¡gina de ConfirmaciÃ³n

```
Cliente es redirigido a tu sitio
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /confirmacion-pago?id=txn_12345          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                           â”‚
â”‚  PaymentConfirmation Component            â”‚
â”‚         â”‚                                 â”‚
â”‚         â”‚ useEffect(() => {               â”‚
â”‚         â”‚   fetchTransactionDetails()     â”‚
â”‚         â”‚ })                              â”‚
â”‚         â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ GET https://production.wompi.co/    â”‚ â”‚
â”‚  â”‚     v1/transactions/txn_12345       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                 â”‚
â”‚         â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  âœ… Â¡Pago Exitoso!                  â”‚ â”‚
â”‚  â”‚                                     â”‚ â”‚
â”‚  â”‚  ID: txn_12345                      â”‚ â”‚
â”‚  â”‚  Referencia: ANT-1729875234567-...  â”‚ â”‚
â”‚  â”‚  Monto: $500,000 COP                â”‚ â”‚
â”‚  â”‚  Estado: APROBADO                   â”‚ â”‚
â”‚  â”‚                                     â”‚ â”‚
â”‚  â”‚  ğŸ“‹ PrÃ³ximos Pasos:                 â”‚ â”‚
â”‚  â”‚  1. Email de confirmaciÃ³n           â”‚ â”‚
â”‚  â”‚  2. Contacto en 24h                 â”‚ â”‚
â”‚  â”‚  3. Entrega del servicio            â”‚ â”‚
â”‚  â”‚                                     â”‚ â”‚
â”‚  â”‚  ğŸ“ Contacto: ...                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PASO 6: AutomatizaciÃ³n N8N (En Paralelo)

```
Wompi envÃ­a webhook
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  N8N Webhook Listener                  â”‚
â”‚  http://tu-n8n.com/webhook/wompi-pmt   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ POST con datos de transacciÃ³n
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  N8N Workflow: "Wompi Payment"         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  1ï¸âƒ£ Webhook Node                       â”‚
â”‚      Recibe datos                      â”‚
â”‚      â”‚                                 â”‚
â”‚      â–¼                                 â”‚
â”‚  2ï¸âƒ£ Function Node                      â”‚
â”‚      Procesa y formatea datos          â”‚
â”‚      {                                 â”‚
â”‚        timestamp: "...",               â”‚
â”‚        transactionId: "txn_12345",     â”‚
â”‚        customerName: "Juan PÃ©rez",     â”‚
â”‚        amount: 500000,                 â”‚
â”‚        ...                             â”‚
â”‚      }                                 â”‚
â”‚      â”‚                                 â”‚
â”‚      â–¼                                 â”‚
â”‚  3ï¸âƒ£ IF Node                            â”‚
â”‚      Â¿status === 'APPROVED'?           â”‚
â”‚      â”‚                                 â”‚
â”‚      â”œâ”€ âœ… SI                          â”‚
â”‚      â”‚   â”‚                             â”‚
â”‚      â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      â”‚   â”‚              â”‚              â”‚
â”‚      â”‚   â–¼              â–¼              â–¼
â”‚      â”‚ 4ï¸âƒ£ Google     5ï¸âƒ£ Email      6ï¸âƒ£ Telegram
â”‚      â”‚   Sheets        Cliente        Equipo
â”‚      â”‚   â”‚              â”‚              â”‚
â”‚      â”‚   â”‚              â”‚              â”‚
â”‚      â””â”€ âŒ NO          â”‚              â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                         â”‚
â”‚                         â–¼
â”‚  7ï¸âƒ£ Respond to Webhook                 â”‚
â”‚      { status: "success" }             â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PASO 7: Google Sheets

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Google Sheets: "Transacciones MÃ¡rmoles Deluxe"                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Timestamp           â”‚ ID Trans.  â”‚ Referencia     â”‚ Estado   â”‚ Tipo    â”‚ Cliente ... â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2025-10-25 10:30:00 â”‚ txn_12345  â”‚ ANT-172987...  â”‚ APPROVED â”‚ ANTICIPOâ”‚ Juan PÃ©rez  â”‚
â”‚ 2025-10-25 11:15:23 â”‚ txn_67890  â”‚ SRV-172988...  â”‚ APPROVED â”‚ SERVICIOâ”‚ MarÃ­a LÃ³pez â”‚
â”‚ 2025-10-25 14:22:45 â”‚ txn_11111  â”‚ PRD-172990...  â”‚ APPROVED â”‚ PRODUCTOâ”‚ Carlos Ruiz â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–²
       â”‚
   Append Row
```

### PASO 8: Email al Cliente

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Email enviado a: juan@example.com      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  De: noreply@marmolesdeluxe.com         â”‚
â”‚  Asunto: âœ… ConfirmaciÃ³n de Pago        â”‚
â”‚                                         â”‚
â”‚  Hola Juan PÃ©rez,                       â”‚
â”‚                                         â”‚
â”‚  Â¡Gracias por tu pago!                  â”‚
â”‚                                         â”‚
â”‚  ğŸ“‹ DETALLES DE TU TRANSACCIÃ“N:         â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”         â”‚
â”‚  â€¢ ID TransacciÃ³n: txn_12345            â”‚
â”‚  â€¢ Referencia: ANT-1729875234567-ABC123 â”‚
â”‚  â€¢ Monto: $500,000 COP                  â”‚
â”‚  â€¢ Producto: MÃ¡rmol Blanco Polar        â”‚
â”‚  â€¢ MÃ©todo: CARD                         â”‚
â”‚                                         â”‚
â”‚  ğŸ¯ PRÃ“XIMOS PASOS:                     â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”         â”‚
â”‚  1ï¸âƒ£ RevisiÃ³n (24h)                      â”‚
â”‚  2ï¸âƒ£ CoordinaciÃ³n                        â”‚
â”‚  3ï¸âƒ£ Entrega                             â”‚
â”‚                                         â”‚
â”‚  ğŸ“ CONTACTO:                           â”‚
â”‚  ğŸ“§ info@marmolesdeluxe.com             â”‚
â”‚  ğŸ’¬ +57 300 123 4567                    â”‚
â”‚                                         â”‚
â”‚  Gracias por confiar en nosotros ğŸ›ï¸     â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PASO 9: Telegram al Equipo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¬ Telegram: Grupo "Ventas"     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                  â”‚
â”‚  ğŸ¤– Bot MÃ¡rmoles Deluxe          â”‚
â”‚  ğŸ”” NUEVO PAGO RECIBIDO          â”‚
â”‚                                  â”‚
â”‚  ğŸ’° Monto: $500,000 COP          â”‚
â”‚  ğŸ‘¤ Cliente: Juan PÃ©rez          â”‚
â”‚  ğŸ“§ Email: juan@example.com      â”‚
â”‚  ğŸ“± TelÃ©fono: 3001234567         â”‚
â”‚                                  â”‚
â”‚  ğŸ“¦ Producto: MÃ¡rmol Blanco...   â”‚
â”‚  ğŸ”¢ Cantidad: 1                  â”‚
â”‚  ğŸ’³ MÃ©todo: CARD                 â”‚
â”‚                                  â”‚
â”‚  ğŸ†” Ref: ANT-1729875234567-...   â”‚
â”‚  â° 25/10/2025 10:30:00          â”‚
â”‚                                  â”‚
â”‚  âœ… Estado: APPROVED             â”‚
â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Flujo de Seguridad (ValidaciÃ³n de Webhook)

```
Wompi envÃ­a webhook con firma
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  N8N Function Node (ValidaciÃ³n)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  1. Recibir datos y firma:           â”‚
â”‚     signature.checksum               â”‚
â”‚                                      â”‚
â”‚  2. Obtener Private Key              â”‚
â”‚                                      â”‚
â”‚  3. Calcular firma esperada:         â”‚
â”‚     HMAC-SHA256(data, private_key)   â”‚
â”‚                                      â”‚
â”‚  4. Comparar firmas:                 â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚     â”‚ signature === expected? â”‚     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚              â”‚                       â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚       â”‚             â”‚               â”‚
â”‚       âœ… SI         âŒ NO           â”‚
â”‚       â”‚             â”‚               â”‚
â”‚       â”‚             â””â”€â–º Rechazar    â”‚
â”‚       â”‚                 y loguear   â”‚
â”‚       â”‚                             â”‚
â”‚       â””â”€â–º Procesar                  â”‚
â”‚           normalmente               â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Estados de la TransacciÃ³n

```
                    Cliente Paga
                         â”‚
                         â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ PENDING â”‚ â—„â”€â”€â”€ Estado inicial
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚               â”‚               â”‚
         â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚APPROVED â”‚    â”‚DECLINED â”‚    â”‚  ERROR  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚               â”‚               â”‚
         â”‚               â”‚               â”‚
         â–¼               â–¼               â–¼
    âœ… Ã‰xito       âŒ Rechazado     âš ï¸ Error
    â”‚                   â”‚               â”‚
    â”‚                   â”‚               â”‚
    â”œâ”€â–º Email           â”œâ”€â–º Email       â”œâ”€â–º Log
    â”œâ”€â–º Telegram        â”‚   (error)     â””â”€â–º Alerta
    â””â”€â–º Google          â””â”€â–º Sin registro
        Sheets              en Sheets


    Puede anularse:
    APPROVED â”€â”€â”€â”€â”€â”€â–º VOIDED
                     (Anulado)
```

---

## ğŸŒ URLs del Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DESARROLLO (Local)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Sitio Web:        http://localhost:4321                â”‚
â”‚  Ejemplos:         http://localhost:4321/ejemplos-pago  â”‚
â”‚  ConfirmaciÃ³n:     http://localhost:4321/confirmacion-  â”‚
â”‚                    pago?id=txn_xxx                       â”‚
â”‚  N8N:              http://localhost:5678                â”‚
â”‚  Webhook N8N:      http://localhost:5678/webhook/       â”‚
â”‚                    wompi-payment                         â”‚
â”‚  Ngrok (tÃºnel):    https://abc123.ngrok.io              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PRODUCCIÃ“N                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Sitio Web:        https://marmolesdeluxe.com           â”‚
â”‚  ConfirmaciÃ³n:     https://marmolesdeluxe.com/          â”‚
â”‚                    confirmacion-pago?id=txn_xxx          â”‚
â”‚  N8N:              https://n8n.marmolesdeluxe.com       â”‚
â”‚  Webhook N8N:      https://n8n.marmolesdeluxe.com/      â”‚
â”‚                    webhook/wompi-payment                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Estructura de Datos

### Objeto de TransacciÃ³n (Wompi)

```javascript
{
  id: "txn_12345",
  status: "APPROVED",
  reference: "ANT-1729875234567-ABC123",
  amount_in_cents: 50000000,
  currency: "COP",
  customer_email: "juan@example.com",
  customer_data: {
    full_name: "Juan PÃ©rez",
    phone_number: "3001234567",
    legal_id: "1234567890",
    legal_id_type: "CC"
  },
  payment_method_type: "CARD",
  payment_method: {
    type: "CARD",
    extra: {
      last_four: "4242",
      brand: "VISA"
    }
  },
  created_at: "2025-10-25T10:30:00.000Z",
  finalized_at: "2025-10-25T10:30:15.000Z",
  metadata: {
    paymentType: "ANTICIPO",
    productName: "MÃ¡rmol Blanco Polar",
    quantity: 1,
    sku: "MAR-BP-001"
  }
}
```

### Registro en Google Sheets

```
| Timestamp           | ID          | Referencia | ... |
|---------------------|-------------|------------|-----|
| 2025-10-25 10:30:00 | txn_12345   | ANT-17...  | ... |
```

---

Esta arquitectura garantiza:

- âœ… Pagos seguros con Wompi
- âœ… ConfirmaciÃ³n inmediata al cliente
- âœ… Registro automÃ¡tico de transacciones
- âœ… Notificaciones en tiempo real
- âœ… Escalabilidad y mantenibilidad
